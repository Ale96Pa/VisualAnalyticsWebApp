<!--
Project name: SRACs.
Description:SRACs is a visual analytics tool for studying and analysing suicides
            rates in order to get useful information for statistic and
            analytical purposes (more details in the final report).
Authors: Alessandro Palma, Stefano Santinelli.
Visual Analytics project: world wide suicide rate and analysis.
Academic Year: 2019-2020
-->

<!DOCTYPE html>

<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Suicides rate and analysis</title>
    <link rel="stylesheet" href="libraries/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="libraries/d3.js"></script>
    <script type="text/javascript" src="libraries/d3-geo.js"></script>
    <script type="text/javascript" src="libraries/topojson.js"></script>
    <script type="text/javascript" src="libraries/mainDiagram.js"></script>
    <script type="text/javascript" src="libraries/secondaryDiagrams.js"></script>
    <script type="text/javascript" src="libraries/provenanceBar.js"></script>
    <script type="text/javascript" src="libraries/filtersParameter.js"></script>
    <script type="text/javascript" src="libraries/yearSlider.js"></script>
    <script type="text/javascript" src="libraries/d3-slider.js"></script>
</head>

<body>

    <div id="mainWrapper">
        <div class="slidecontainer">
            <div id="slider-step"></div>
        </div>
        <div id="mainDiagram">
        </div>

        <div class="tab">
            <button  id="linearChart" class="tablinks" >LinearChart</button>
            <button id="scatterPlot" class="tablinks" >Scatterplot</button>
            <button id="parallelCoordinates" class="tablinks" >ParallelCoordinatesChart</button>
            <button id="barChart" class="tablinks" >barChart</button>
        </div>
        <div id="secondDiagram" class="tabcontents">
            <button class="provenanceButton" id="saveOnProvenance">Save on provenance</button>
        </div>
    </div>

    <div id="filterBar">
        <div id="filters">
        </div>

        <div id="map">
        </div>
        <hr>
        <div id="selection">
            <div id="sexContainer" class="container" transform="translate( 30 , 10)">
                <legend>Sex</legend>
                <label>Male<input id="male" type="checkbox" checked></label>
                <label>Female<input id="female" type="checkbox" checked></label>
            </div>
            <div id="ageContainer" class="container" transform="translate( 30 , 10)">
                <legend>Age</legend>
                <label>05-14 years<input id="5-14" type="checkbox" checked></label>
                <label>15-24 years<input id="15-24" type="checkbox" checked></label>
                <label>25-34 years<input id="25-34" type="checkbox" checked></label>
                <label>35-54 years<input id="35-54" type="checkbox" checked></label>
                <label>55-74 years<input id="55-74" type="checkbox" checked></label>
                <label>over 75 years<input id="75+" type="checkbox" checked></label>
            </div>
            <div id="generationContainer" class="container" transform="translate( 30 , 10)">
                <legend>Generation</legend>
                <label>G.I. generation (born: 1900 to 1924)<input id="genGI" type="checkbox" checked></label>
                <label>Silent generation (born: 1925 to 1945)<input id="genSilent" type="checkbox" checked></label>
                <label>Baby Boomers (born: 1946 to 1964)<input id="genBoomers" type="checkbox" checked></label>
                <label>Generation X (born: 1965 to 1979)<input id="genX" type="checkbox" checked></label>
                <label>Millenials (born: 1980 to 2000)<input id="genMillenials" type="checkbox" checked></label>
                <label>Generation Z (born post 2000)<input id="genZ" type="checkbox" checked></label>
            </div>
        </div>
    </div>

    <div id="provenanceBar" >
        <button class="provenanceButton" onclick="window.location.href = 'review.html';">Review</button>
    </div>
</body>

<script>
    
    

    async function loadData(){
        return data = await d3.csv("dataset/fullDataset.csv");
    }

    var selectionData = ["dati","disponibili"];

    loadData().then(data =>{
        
        slideYear("#slider-step", data);

        function changeSecDiagram(button) {
            var svg;

            d3.selectAll(".tablinks").style("background-color", "darkgray");
            d3.select("#"+ button.id).style("background-color", "gray")

            if ( button.id == "linearChart"){
                d3.select("#secondDiagram").selectAll("svg").remove();
                svg = drawLinearChart("#secondDiagram", data);
            }
            if (button.id == "scatterPlot"){
                d3.select("#secondDiagram").selectAll("svg").remove();
                svg = drawScatterplot("#secondDiagram", data);
            }
            if(button.id == "parallelCoordinates"){
                d3.select("#secondDiagram").selectAll("svg").remove();
                svg = drawParallelCoordinatesChart("#secondDiagram", data);
            }
            if(button.id == "barChart"){
                d3.select("#secondDiagram").selectAll("svg").remove();
                svg = drawPatternBarchart("#secondDiagram", data);
            }
            //TODO: added all diagrams --> CHECK !!
            return svg;
        }

        var currentSvg = null;
        var svgs_to_save = []
        var buttonSaveProvenance = document.getElementById("saveOnProvenance");
        
        document.getElementById("linearChart").onclick = function() {
            currentSvg = changeSecDiagram(this);
            buttonSaveProvenance.onclick=function(){saveSvgFile("provenanceBar", currentSvg, svgs_to_save);}
        };
        document.getElementById("scatterPlot").onclick = function() {
            currentSvg = changeSecDiagram(this);
            buttonSaveProvenance.onclick=function(){saveSvgFile("provenanceBar", currentSvg, svgs_to_save);}
        };
        document.getElementById("parallelCoordinates").onclick = function() {
            currentSvg = changeSecDiagram(this);
            buttonSaveProvenance.onclick=function(){saveSvgFile("provenanceBar", currentSvg, svgs_to_save);}
        };
        document.getElementById("barChart").onclick = function() {
            currentSvg = changeSecDiagram(this);
            buttonSaveProvenance.onclick=function(){saveSvgFile("provenanceBar", currentSvg, svgs_to_save);}
            console.log(currentSvg);
        };

        var filteredData;
        var male = true,female = true;
        var age5_14=true,age15_24=true,age25_34=true,age35_54 = true,age55_74=true,age75=true;
        var genGi = true,genSilent = true,genBoomers = true,genX = true,genMillenials = true,genZ = true;
        
        var male = true;
        document.getElementById("male").onclick = function() {
            if ( this.checked ) {male=true;}
            else {male=false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("female").onclick = function() {
            if ( this.checked ) {female = true;}
            else {female = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("5-14").onclick = function() {
            if ( this.checked ) {age5_14 = true;}
            else {age5_14 = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("15-24").onclick = function() {
            if ( this.checked ) {age15_24 = true;}
            else {age15_24 = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("25-34").onclick = function() {
            if ( this.checked ) {age25_34=true;}
            else {age25_34=false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("35-54").onclick = function() {
            if ( this.checked ) {age35_54 = true;}
            else {age35_54 = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("55-74").onclick = function() {
            if ( this.checked ) {age55_74 = true;}
            else {age55_74 = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("75+").onclick = function() {
            if ( this.checked ) {age75 = true;}
            else {age75 = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("genGI").onclick = function() {
            if ( this.checked ) {genGi = true;}
            else {genGi = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("genSilent").onclick = function() {
            if ( this.checked ) {genSilent = true;}
            else {genSilent = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("genBoomers").onclick = function() {
            if ( this.checked ) {genBoomers = true;}
            else {genBoomers = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("genX").onclick = function() {
            if ( this.checked ) {genX = true;}
            else {genX = false;}
            changeSecondOnCheckBox(data)
        };
        document.getElementById("genMillenials").onclick = function() {
            if ( this.checked ) {genMillenials = true;}
            else {genMillenials = false;}
            changeSecondOnCheckBox(data)
        };

        document.getElementById("genZ").onclick = function() {
            if ( this.checked ) {genZ = true;}
            else {genZ = false;}
            d3.select("#secondDiagram").selectAll("svg").remove();
            changeSecondOnCheckBox(data)
        };

        function changeSecondOnCheckBox(data){
            filteredData = filterAllDataCheckbox(selectionData, male, female, age5_14, age15_24, age25_34,
                age35_54, age55_74, age75, genGi, genSilent, genBoomers, genX,
                genMillenials, genZ);
            console.log(selectionData);
        }

        worldMap("map");
    });


    async function loadDataPca(){
        return data = await d3.csv("dataset/fullDataset.csv");
    }
    loadDataPca().then(data =>{
        filteredData = data.filter(function(row) {
            return row['year'] == '1990';
        });
        drawMainDiagram("#mainDiagram", filteredData);
        filters("#filters", filteredData);
        /*
        var colX = data.map(function(d) { return d.X })
        var colY = data.map(function(d) { return d.Y })
        var XY_array = []
        for (var i = 0; i < colX.length; i++) {
            XY_array[i] = [colX[i], colY[i]];
        }*/
        //console.log(XY_array);

        //drawLinearChart("#secondDiagram", XY_array);
        //console.log(arr);
    });

</script>

</html>
